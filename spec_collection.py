import json
import requests
import time
import os

# spec_id_list = ['18.752', '18.13', '18.16', '18.56', '18.57', '18.73', '18.75', '18.81', '18.84', '18.85', '18.86',
#                 '18.118', '18.129', '18.130', '18.142', '18.143', '18.153', '18.174', '18.190', '18.201', '18.208',
#                 '18.212', '18.245', '18.263', '18.265', '18.290', '18.291', '18.297', '18.298', '18.299', '18.300',
#                 '18.330', '18.339', '18.348', '18.354', '18.360', '18.361', '18.373', '26.406', '26.407', '26.408',
#                 '26.409', '26.410', '26.411', '26.412', '26.413', '26.414', '26.415', '26.416', '26.419', '26.427',
#                 '26.437', '26.439', '26.449', '26.473', '26.574', '26.742', '19.421', '19.430', '19.483', '19.586',
#                 '19.754', '19.18', '19.19', '19.28', '19.108', '19.109', '19.147', '19.170', '19.259', '19.282',
#                 '19.283', '19.284', '19.285', '19.357', '23.422', '23.442', '23.476', '23.477', '23.478', '23.479',
#                 '23.539', '23.759', '23.2', '23.21', '23.29', '23.36', '23.72', '23.88', '23.120', '23.159', '23.165',
#                 '23.182', '23.187', '23.188', '23.214', '23.266', '23.276', '23.286', '23.311', '23.314', '23.352',
#                 '23.362', '3.423', '3.507', '3.508', '3.509', '3.747', '3.1', '3.8', '3.26', '3.31', '3.40', '3.48',
#                 '3.64', '3.90', '3.98', '3.114', '3.119', '3.148', '3.150', '3.151', '3.166', '3.171', '3.206', '3.209',
#                 '3.213', '3.230', '3.236', '3.244', '3.253', '3.294', '3.305', '3.318', '3.328', '2.425', '2.434',
#                 '2.454', '2.463', '2.464', '2.465', '2.467', '2.468', '2.469', '2.523', '2.737', '2.33', '2.43', '2.44',
#                 '2.46', '2.100', '2.102', '2.125', '2.164', '2.179', '2.200', '2.249', '2.261', '2.335', '2.337',
#                 '2.342', '2.343', '2.344', '2.351', '4.428', '4.429', '4.456', '4.494', '4.734', '4.32', '4.47', '4.52',
#                 '4.127', '4.181', '4.205', '4.207', '4.255', '4.264', '4.271', '4.278', '4.332', '4.338', '4.374',
#                 '16.435', '16.569', '16.570', '16.571', '16.658', '16.739', '16.760', '16.761', '16.38', '16.194',
#                 '16.216', '11.436', '11.745', '11.62', '11.71', '11.76', '11.99', '11.134', '11.157', '11.160',
#                 '11.173', '11.218', '11.240', '11.243', '11.293', '11.347', '9.448', '9.452', '9.521', '9.532', '9.562',
#                 '9.738', '9.22', '9.67', '9.78', '9.94', '9.95', '9.105', '9.115', '9.139', '9.145', '9.168', '9.226',
#                 '9.238', '9.289', '9.307', '9.312', '9.317', '9.321', '9.345', '7.455', '7.502', '7.503', '7.565',
#                 '7.566', '7.733', '7.14', '7.222', '7.235', '7.239', '7.267', '7.392', '8.461', '8.462', '8.519',
#                 '8.575', '8.736', '8.77', '8.135', '8.202', '8.260', '8.356', '10.470', '10.471', '10.472', '10.740',
#                 '10.54', '10.80', '10.191', '10.258', '10.315', '10.323', '10.393', '22.491', '22.504', '22.505',
#                 '22.518', '22.529', '22.530', '22.531', '22.757', '22.11', '22.35', '22.39', '22.55', '22.104',
#                 '22.175', '22.193', '22.198', '22.199', '22.204', '22.223', '22.248', '22.316', '22.329', '22.353',
#                 '24.492', '24.493', '24.624', '24.753', '24.377', '24.378', '24.379', '24.380', '29.495', '29.510',
#                 '29.511', '29.512', '29.513', '29.514', '29.515', '29.516', '29.517', '29.540', '29.541', '29.542',
#                 '29.543', '29.544', '29.545', '29.546', '29.547', '29.548', '29.549', '29.550', '29.551', '29.552',
#                 '29.553', '29.554', '29.555', '29.556', '29.557', '29.558', '29.559', '29.560', '29.561', '29.581',
#                 '29.582', '29.583', '29.588', '29.162', '27.496', '27.497', '27.498', '27.499', '27.500', '27.501',
#                 '27.533', '27.584', '27.741', '15.730', '15.731', '15.750', '15.764', '15.68', '15.93', '15.96',
#                 '15.140', '15.146', '15.167', '15.237', '15.281', '15.288', '15.308', '15.313', '15.320', '15.346',
#                 '15.363', '15.388', '15.389', '15.390', '15.391', '25.743', '25.381', '25.382', '25.383', '25.384',
#                 '25.385', '25.386', '12.746', '12.5', '12.6', '12.7', '12.92', '12.97', '12.122', '12.180', '12.197',
#                 '12.251', '12.252', '12.280', '12.322', '12.326', '12.331', '12.376', '14.749', '14.762', '14.37',
#                 '14.60', '14.87', '14.91', '14.141', '14.169', '14.178', '14.217', '14.340', '14.349', '14.355',
#                 '14.364', '6.758', '6.107', '6.184', '6.247', '6.254', '6.309', '6.319', '6.336']

spec_id_list = ['17.405', '17.441', '17.580', '17.156', '17.303', '17.350', '13.567', '5.215', '5.234', '5.241', '5.304', '5.341', '5.365', '5.366', '5.367', '5.368', '5.370', '5.372', '5.394', '21.402', '21.403', '21.292', '18.86', '18.291', '26.407', '26.408', '26.409', '26.410', '26.411', '26.413', '26.414', '26.415', '26.427', '19.421', '19.430', '19.586', '19.754', '19.28', '19.147', '19.259', '19.285', '23.422', '23.442', '23.539', '23.2', '23.21', '23.72', '23.88', '23.159', '23.165', '23.188', '23.266', '23.276', '23.286', '3.423', '3.507', '3.508', '3.1', '3.213', '3.244', '3.294', '2.465', '2.523', '2.737', '2.46', '2.125', '2.200', '2.351', '4.456', '16.435', '16.569', '16.570', '16.571', '16.38', '11.76', '11.99', '11.218', '11.243', '9.448', '9.452', '9.521', '9.532', '9.562', '9.78', '9.95', '9.105', '9.115', '9.139', '9.168', '9.312', '7.502', '10.393', '22.505', '22.530', '22.531', '22.11', '22.198', '22.316', '24.753', '29.540', '29.543', '29.544', '29.546', '29.547', '29.548', '29.550', '29.554', '29.555', '29.561', '29.582', '27.498', '27.499', '27.501', '27.533', '27.741', '15.731', '15.96', '15.281', '25.743', '25.382', '25.383', '12.6', '12.7', '12.122', '12.252', '12.280', '12.322', '14.37']

empty_list = []

for spec in spec_id_list:
    page_list = [f for f in os.listdir('./docs/specialization/{}/pages/'.format(spec)) if not f.startswith('.') and
                 os.path.isfile(os.path.join('./docs/specialization/{}/pages/'.format(spec), f))]
    print(spec, page_list)
    if len(page_list) > 0:
        for page in page_list:
            f = open('./docs/specialization/{}/pages/{}'.format(spec, page), encoding='utf8')
            jsonText = f.read()
            f.close()

            jsonObj = json.loads(jsonText)
            for v in jsonObj['items']:
                req = requests.get(v['url'])
                data = req.content.decode()
                req.close()

                fileName = './docs/specialization/{}/{}.json'.format(spec, v['id'])
                f = open(fileName, 'w', encoding='utf8')
                f.write(data)
                f.close()

                print('{} для {} сделана'.format(v['id'], spec))
                time.sleep(0.1)

            print('{} страница для {} обработана'.format(page, spec))

        print('Вакансии для {} собраны'.format(spec))
    # else:
    #     empty_list.append('{}'.format(spec))
    #     print('Недостаточно страниц, {} добавлена в список'.format(spec))
    #     print(empty_list)

print('Вакансии собраны')



